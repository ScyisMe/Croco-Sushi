{
    servers {
        protocols h1 h2 h3
        metrics
    }
    admin :2019
}

crocosushi.com {
    encode gzip zstd
    reverse_proxy frontend:3000
}

www.crocosushi.com {
    redir https://crocosushi.com{uri}
}

api.crocosushi.com {
    encode gzip zstd
    
    # Serve uploads directly from filesystem
    handle_path /static/uploads/* {
        root * /srv/uploads
        file_server
        header Cache-Control "public, max-age=31536000, immutable"
    }

    reverse_proxy backend:8000
}
monitor.crocosushi.com {
    encode gzip zstd
    reverse_proxy grafana:3000
}