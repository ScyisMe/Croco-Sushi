# Технічне завдання (ТЗ) на розробку сайту Croco Sushi

## 1. ЗАГАЛЬНА ІНФОРМАЦІЯ

### 1.1. Мета проекту
Розробка повнофункціонального сайту доставки суші "Croco Sushi" з функціоналом аналогічним до king-roll.com.ua, включаючи:
- Каталог продуктів з категоріями
- Кошик та оформлення замовлень
- Систему доставки
- Адмін-панель для управління
- Інтеграції для платежів та доставки
- Максимальну безпеку та стабільність
- Високу продуктивність та масштабованість

### 1.2. Назва проекту
**Croco Sushi** - сервіс доставки суші

### 1.3. Технологічний стек (на основі наявного проекту)
- **Backend:** FastAPI + PostgreSQL + SQLAlchemy (async)
- **Frontend:** React/Next.js 14+ (App Router)
- **База даних:** PostgreSQL 17
- **Кешування:** Redis 7
- **Завдання:** Celery
- **Міграції:** Alembic
- **Контейнеризація:** Docker & Docker Compose
- **Моніторинг:** Sentry, Prometheus + Grafana
- **CI/CD:** GitHub Actions / GitLab CI

---

## 2. ФУНКЦІОНАЛЬНІ ВИМОГИ

### 2.1. Публічна частина сайту

#### 2.1.1. Головна сторінка
- [ ] **Шапка (Header):**
  - Логотип "Croco Sushi"
  - Меню навігації: Меню, Доставка, Акції, Відгуки
  - Іконка кошика з кількістю товарів та модальним вікном
  - Контактні телефони з можливістю передзвону
  - Вибір мови (UA/RU)
  - Індикатор робочого часу (10:00 - 22:00)
  - Стікі хедер при прокрутці
  
- [ ] **Hero-секція:**
  - Велике зображення з призивом до дії
  - Кнопка "Оформити замовлення"
  - Skeleton loader під час завантаження
  
- [ ] **Секція "Акційні пропозиції":**
  - Карусель/слайдер з акційними товарами
  - Відображення товарів з прапорцями "Акція", "Новинка", "Хіт продажів"
  - Lazy loading для зображень
  
- [ ] **Категорії меню:**
  - Горизонтальна прокрутка або сітка категорій
  - Клікабельні картки з іконками та назвами
  - Категорії (на основі king-roll.com.ua):
    - Фірмові
    - Класичні
    - Сети
    - Запечені
    - Black
    - Wok та Супи
    - Салати
    - Суші
    - Напої
  
- [ ] **Футер (Footer):**
  - Контактна інформація (телефони, адреса)
  - Посилання на соціальні мережі
  - Меню: Про нас, Доставка, Акції, Політика конфіденційності
  - Графік роботи
  - Копірайт

#### 2.1.2. Сторінка каталогу товарів
- [ ] Фільтрація по категоріях
- [ ] Пошук товарів по назві (з debounce)
- [ ] Сортування (популярність, ціна, новинки)
- [ ] Пагінація або infinite scroll
- [ ] Breadcrumbs навігація
- [ ] Швидкий перегляд товару (Quick View modal)
- [ ] Картки товарів з:
  - Зображенням (WebP з fallback)
  - Назвою
  - Описом/складом
  - Ціною (з акційною ціною, якщо є)
  - Кнопкою "Додати в кошик"
  - Прапорцями "Новинка", "Хіт", "Акція"
  - Іконкою "Додати в обране"

#### 2.1.3. Сторінка товару
- [ ] Велике зображення товару (з можливістю збільшення)
- [ ] Галерея зображень (якщо є кілька)
- [ ] Назва товару
- [ ] Повний опис та склад
- [ ] Вибір розміру порції (Стандарт/Великий) з різними цінами
- [ ] Підрахунок калорій (якщо є)
- [ ] Ціна
- [ ] Кнопка "Додати в кошик" з можливістю вибору кількості
- [ ] Похожі товари (recommendations)
- [ ] Відгуки про товар
- [ ] Schema.org markup для SEO

#### 2.1.4. Кошик (Cart)
- [ ] Модальне вікно/сайдбар з переліком товарів
- [ ] Відображення:
  - Зображення товару
  - Назва
  - Розмір порції
  - Ціна за одиницю
  - Кількість (+/- кнопки)
  - Загальна ціна по позиції
  - Кнопка видалення
- [ ] Підрахунок:
  - Підсумок без доставки
  - Вартість доставки (динамічний розрахунок)
  - Загальна сума
- [ ] Кнопка "Оформити замовлення"
- [ ] Збереження кошика в localStorage
- [ ] Синхронізація кошика для авторизованих користувачів
- [ ] Валідація мінімальної суми замовлення
- [ ] Максимум 20 товарів в кошику
- [ ] Автоматичне видалення недоступних товарів

#### 2.1.5. Оформлення замовлення
- [ ] **Автозбереження форми** (localStorage)
- [ ] **Індикатор прогресу** (4 кроки)
- [ ] **Крок 1: Контактні дані**
  - Ім'я (обов'язково, мін 2 символи)
  - Телефон (обов'язково, формат +380XXXXXXXXX)
  - Email (опціонально, валідація email)
  
- [ ] **Крок 2: Адреса доставки**
  - Місто (автопідстановка з Google Places API)
  - Вулиця
  - Будинок
  - Квартира/офіс
  - Коментар для кур'єра (макс 500 символів)
  - Можливість зберегти адресу (для зареєстрованих)
  - Калькулятор вартості доставки в реальному часі
  
- [ ] **Крок 3: Спосіб оплати**
  - Готівка кур'єру
  - Картка онлайн (через LiqPay/Fondy)
  - Картка кур'єру
  
- [ ] **Крок 4: Підтвердження**
  - Перегляд всіх даних
  - Коментар до замовлення
  - Згода з публічною офертою (checkbox)
  - Згода на обробку персональних даних (checkbox)
  - Кнопка "Підтвердити замовлення"
  
- [ ] **Після оформлення:**
  - Сторінка підтвердження з номером замовлення
  - SMS-сповіщення (якщо інтегровано)
  - Email-підтвердження
  - Можливість переглянути статус замовлення
  - Кнопка "Відстежити замовлення"

#### 2.1.6. Сторінка "Доставка"
- [ ] Умови доставки
- [ ] Зони доставки та тарифи
- [ ] Мінімальна сума замовлення
- [ ] Час доставки
- [ ] Графік роботи
- [ ] Карта зон доставки (Google Maps / OpenStreetMap)
- [ ] FAQ по доставці

#### 2.1.7. Сторінка "Акції"
- [ ] Список актуальних акцій
- [ ] Фільтрація по категоріях
- [ ] Картки акцій з описом та умовами
- [ ] Таймер до кінця акції
- [ ] Прогрес-бар заповнення (якщо є обмеження)

#### 2.1.8. Сторінка "Відгуки"
- [ ] Відображення відгуків клієнтів
- [ ] Рейтинг (зірки)
- [ ] Фото відгуків (якщо є)
- [ ] Відповіді адміністрації
- [ ] Форма для додавання відгуку (для зареєстрованих або після замовлення)
- [ ] Модерація перед публікацією

#### 2.1.9. Функціонал передзвону
- [ ] Модальне вікно з формою
- [ ] Поле для введення телефону (з валідацією)
- [ ] Кнопка "Передзвонити"
- [ ] Відправка запиту на backend
- [ ] Підтвердження відправки (toast notification)
- [ ] Rate limiting (3 запити на годину з одного IP)

#### 2.1.10. Додаткові функції
- [ ] **Wishlist (Обране):**
  - Додавання товарів в обране
  - Сторінка з обраними товарами
  - Синхронізація для авторизованих
  
- [ ] **Порівняння товарів:**
  - Додавання до порівняння
  - Таблиця порівняння характеристик
  
- [ ] **Історія переглядів:**
  - Збереження останніх переглянутих товарів
  - Відображення в футері/сайдбарі

### 2.2. Система аутентифікації та реєстрації

#### 2.2.1. Реєстрація
- [ ] Реєстрація по телефону (обов'язково)
- [ ] Email (опціонально)
- [ ] Пароль (мін 8 символів, 1 цифра, 1 велика літера)
- [ ] Підтвердження номера телефону через SMS
- [ ] Автоматична реєстрація при першому замовленні
- [ ] Капча для захисту від ботів
- [ ] Rate limiting (3 спроби на годину)

#### 2.2.2. Вхід
- [ ] Вхід по телефону + пароль
- [ ] "Швидкий вхід" по SMS коду
- [ ] Відновлення пароля
- [ ] JWT токени (Access + Refresh)
- [ ] Remember me функція
- [ ] Обмеження спроб входу (5 спроб, потім блокування на 15 хв)
- [ ] Логування всіх спроб входу

#### 2.2.3. Двофакторна аутентифікація (2FA)
- [ ] Опціональна 2FA для користувачів
- [ ] Обов'язкова 2FA для адмінів
- [ ] QR-код для Google Authenticator
- [ ] Backup коди

#### 2.2.4. Особистий кабінет (для зареєстрованих)
- [ ] **Профіль:**
  - Редагування контактних даних
  - Зміна пароля
  - Налаштування 2FA
  - Підписка на розсилку
  - Налаштування сповіщень
  
- [ ] **Адреси:**
  - Список збережених адрес
  - Додавання нової адреси
  - Редагування адреси
  - Видалення адреси
  - Встановлення адреси за замовчуванням
  
- [ ] **Історія замовлень:**
  - Список всіх замовлень
  - Деталі замовлення
  - Статус замовлення (з трекінгом)
  - Повторне замовлення (one-click reorder)
  - Відгук на замовлення
  - Скасування замовлення (до певного статусу)
  
- [ ] **Програма лояльності:**
  - Баланс бонусних балів
  - Історія нарахувань/списань
  - Статус клієнта (Новий/Срібний/Золотий)
  - Реферальне посилання
  
- [ ] **Обране:**
  - Список улюблених товарів
  - Швидке додавання в кошик

### 2.3. Адмін-панель

#### 2.3.1. Авторизація адмінів
- [ ] Вхід по email/телефону + пароль
- [ ] Обов'язкова 2FA (Google Authenticator)
- [ ] JWT токени для безпеки
- [ ] Ролі: super_admin, admin, manager
- [ ] IP whitelist (опціонально)
- [ ] Логування всіх дій адмінів

#### 2.3.2. Управління категоріями
- [ ] CRUD операції для категорій
- [ ] Завантаження зображень (макс 5MB, JPEG/PNG/WebP)
- [ ] Налаштування порядку відображення (drag & drop)
- [ ] Активація/деактивація
- [ ] SEO поля (meta title, description)
- [ ] Bulk операції (масове видалення)

#### 2.3.3. Управління товарами
- [ ] CRUD операції для товарів
- [ ] Завантаження зображень (мультиплікат, макс 10 фото)
- [ ] Автоматична оптимізація зображень (WebP conversion)
- [ ] Налаштування цін (базова ціна, акційна ціна)
- [ ] Вибір категорії
- [ ] Додавання опису, складу, калорій
- [ ] Прапорці: новинка, хіт, акція
- [ ] Налаштування доступності (is_available)
- [ ] Налаштування порядку відображення
- [ ] Множинні розміри порцій (Стандарт/Великий) з різними цінами
- [ ] SEO поля для кожного товару
- [ ] Bulk операції (масове оновлення цін, статусів)
- [ ] Імпорт/експорт товарів (CSV/Excel)

#### 2.3.4. Управління замовленнями
- [ ] Список всіх замовлень з фільтрацією:
  - По статусу
  - По даті (date range picker)
  - По клієнту (пошук)
  - По номеру замовлення
  - По сумі (від-до)
- [ ] Детальний перегляд замовлення
- [ ] Зміна статусу замовлення (з підтвердженням)
- [ ] Історія змін статусу
- [ ] Додавання коментарів (внутрішніх)
- [ ] Експорт замовлень (CSV/Excel)
- [ ] Друк чека
- [ ] Призначення кур'єра
- [ ] SMS/Email сповіщення клієнту про зміну статусу
- [ ] Повернення/скасування замовлення

#### 2.3.5. Управління клієнтами
- [ ] Список користувачів (з пагінацією)
- [ ] Деталі користувача
- [ ] Історія замовлень клієнта
- [ ] Статистика по клієнту (сума, кількість замовлень)
- [ ] Блокування/розблокування
- [ ] Нарахування бонусів вручну
- [ ] Експорт бази клієнтів

#### 2.3.6. Управління зонами доставки
- [ ] Перегляд зон доставки
- [ ] Додавання нових зон
- [ ] Налаштування тарифів доставки
- [ ] Мінімальна сума для безкоштовної доставки
- [ ] Графік роботи по зонах

#### 2.3.7. Управління акціями
- [ ] CRUD операції для акцій
- [ ] Налаштування дати початку/закінчення
- [ ] Прив'язка до категорій/товарів
- [ ] Тип знижки (%, фіксована сума)
- [ ] Умови застосування (мін сума, кількість товарів)
- [ ] Промокоди
- [ ] Обмеження використання (на користувача, загалом)

#### 2.3.8. Управління відгуками
- [ ] Модерація відгуків
- [ ] Публікація/приховування
- [ ] Відповідь на відгук
- [ ] Фільтрація (опубліковані/на модерації)
- [ ] Видалення спаму

#### 2.3.9. Статистика та аналітика
- [ ] **Дашборд з ключовими метриками:**
  - Кількість замовлень (сьогодні/тиждень/місяць/рік)
  - Виручка (з графіками)
  - Середній чек
  - Популярні товари (топ 10)
  - Статуси замовлень (діаграма)
  - Нові клієнти
  - Повернені клієнти (retention)
  - Конверсія
  
- [ ] **Детальні звіти:**
  - Звіт по продажах
  - Звіт по категоріях
  - Звіт по клієнтам
  - Звіт по джерелах трафіку
  - ABC/XYZ аналіз товарів
  
- [ ] **Експорт звітів** (PDF, Excel)

#### 2.3.10. Налаштування сайту
- [ ] **Загальні налаштування:**
  - Назва сайту
  - Контактна інформація (телефони, email, адреса)
  - Графік роботи
  - Мінімальна сума замовлення
  - Вартість доставки
  
- [ ] **Налаштування інтеграцій:**
  - SMS (API ключі)
  - Платежі (LiqPay/Fondy credentials)
  - Google Maps API
  - Google Analytics
  - Facebook Pixel
  
- [ ] **Email налаштування:**
  - SMTP сервер
  - Шаблони листів
  
- [ ] **SEO налаштування:**
  - Meta tags за замовчуванням
  - Google Analytics ID
  - Google Tag Manager
  - Яндекс Метрика

#### 2.3.11. Audit Log (Логування дій)
- [ ] Журнал всіх дій адмінів
- [ ] Фільтрація по типу дії, даті, адміну
- [ ] Відображення старих та нових значень
- [ ] IP адреса та час дії
- [ ] Експорт логів

### 2.4. API Endpoints (Backend)

#### 2.4.1. Публічні endpoints
```
# Категорії
GET    /api/v1/categories              # Список категорій
GET    /api/v1/categories/{slug}       # Категорія за slug

# Товари
GET    /api/v1/products                # Список товарів (з фільтрацією)
GET    /api/v1/products/{slug}         # Товар за slug
GET    /api/v1/products/popular        # Популярні товари
GET    /api/v1/products/{id}/recommendations # Рекомендації

# Акції
GET    /api/v1/promotions              # Актуальні акції
GET    /api/v1/promotions/{slug}       # Деталі акції

# Відгуки
GET    /api/v1/reviews                 # Публічні відгуки
GET    /api/v1/reviews/product/{id}    # Відгуки по товару

# Замовлення
POST   /api/v1/orders                  # Створення замовлення
GET    /api/v1/orders/{order_number}/track # Відстеження замовлення

# Передзвін
POST   /api/v1/callback                # Запит на передзвін

# Доставка
POST   /api/v1/delivery/calculate      # Розрахунок вартості доставки

# Налаштування
GET    /api/v1/settings/public         # Публічні налаштування (графік роботи, контакти)
```

#### 2.4.2. Аутентифікація
```
POST   /api/v1/auth/register           # Реєстрація
POST   /api/v1/auth/login              # Вхід
POST   /api/v1/auth/logout             # Вихід
POST   /api/v1/auth/logout-all         # Вихід з усіх пристроїв
POST   /api/v1/auth/refresh            # Оновлення токену
POST   /api/v1/auth/send-sms           # Відправка SMS коду
POST   /api/v1/auth/verify-sms         # Підтвердження SMS коду
POST   /api/v1/auth/reset-password     # Відновлення пароля
POST   /api/v1/auth/change-password    # Зміна пароля

# 2FA
POST   /api/v1/auth/2fa/enable         # Увімкнути 2FA
POST   /api/v1/auth/2fa/verify         # Перевірка 2FA коду
POST   /api/v1/auth/2fa/disable        # Вимкнути 2FA
GET    /api/v1/auth/2fa/backup-codes   # Отримати backup коди
```

#### 2.4.3. Користувач (зареєстрований)
```
# Профіль
GET    /api/v1/users/me                # Мій профіль
PUT    /api/v1/users/me                # Оновлення профілю
DELETE /api/v1/users/me                # Видалення акаунту

# Адреси
GET    /api/v1/users/me/addresses      # Мої адреси
POST   /api/v1/users/me/addresses      # Додати адресу
PUT    /api/v1/users/me/addresses/{id} # Оновити адресу
DELETE /api/v1/users/me/addresses/{id} # Видалити адресу
PUT    /api/v1/users/me/addresses/{id}/default # Встановити за замовчуванням

# Замовлення
GET    /api/v1/users/me/orders         # Мої замовлення
GET    /api/v1/users/me/orders/{id}    # Деталі замовлення
POST   /api/v1/users/me/orders/{id}/reorder # Повторити замовлення
PUT    /api/v1/users/me/orders/{id}/cancel # Скасувати замовлення

# Відгуки
POST   /api/v1/users/me/reviews        # Додати відгук
GET    /api/v1/users/me/reviews        # Мої відгуки
PUT    /api/v1/users/me/reviews/{id}   # Редагувати відгук
DELETE /api/v1/users/me/reviews/{id}   # Видалити відгук

# Обране
GET    /api/v1/users/me/favorites      # Обрані товари
POST   /api/v1/users/me/favorites/{product_id} # Додати в обране
DELETE /api/v1/users/me/favorites/{product_id} # Видалити з обраного

# Програма лояльності
GET    /api/v1/users/me/loyalty        # Інфо про бонуси
GET    /api/v1/users/me/loyalty/history # Історія балів
GET    /api/v1/users/me/referral       # Реферальне посилання
```

#### 2.4.4. Адмін endpoints
```
# Категорії
GET    /api/v1/admin/categories
POST   /api/v1/admin/categories
PUT    /api/v1/admin/categories/{id}
DELETE /api/v1/admin/categories/{id}
PUT    /api/v1/admin/categories/bulk-delete # Масове видалення
PUT    /api/v1/admin/categories/reorder     # Зміна порядку

# Товари
GET    /api/v1/admin/products
POST   /api/v1/admin/products
PUT    /api/v1/admin/products/{id}
DELETE /api/v1/admin/products/{id}
POST   /api/v1/admin/products/{id}/images
DELETE /api/v1/admin/products/{id}/images/{image_id}
PUT    /api/v1/admin/products/bulk-update   # Масове оновлення
DELETE /api/v1/admin/products/bulk-delete   # Масове видалення
POST   /api/v1/admin/products/import        # Імпорт товарів
GET    /api/v1/admin/products/export        # Експорт товарів

# Замовлення
GET    /api/v1/admin/orders
GET    /api/v1/admin/orders/{id}
PUT    /api/v1/admin/orders/{id}/status
POST   /api/v1/admin/orders/{id}/comment
PUT    /api/v1/admin/orders/{id}/assign-courier
GET    /api/v1/admin/orders/export

# Користувачі
GET    /api/v1/admin/users
GET    /api/v1/admin/users/{id}
PUT    /api/v1/admin/users/{id}
PUT    /api/v1/admin/users/{id}/block
PUT    /api/v1/admin/users/{id}/unblock
POST   /api/v1/admin/users/{id}/add-bonus
GET    /api/v1/admin/users/export

# Відгуки
GET    /api/v1/admin/reviews
PUT    /api/v1/admin/reviews/{id}
DELETE /api/v1/admin/reviews/{id}
PUT    /api/v1/admin/reviews/{id}/publish
PUT    /api/v1/admin/reviews/{id}/hide
POST   /api/v1/admin/reviews/{id}/reply

# Акції
GET    /api/v1/admin/promotions
POST   /api/v1/admin/promotions
PUT    /api/v1/admin/promotions/{id}
DELETE /api/v1/admin/promotions/{id}

# Промокоди
GET    /api/v1/admin/promo-codes
POST   /api/v1/admin/promo-codes
PUT    /api/v1/admin/promo-codes/{id}
DELETE /api/v1/admin/promo-codes/{id}

# Зони доставки
GET    /api/v1/admin/delivery-zones
POST   /api/v1/admin/delivery-zones
PUT    /api/v1/admin/delivery-zones/{id}
DELETE /api/v1/admin/delivery-zones/{id}

# Статистика
GET    /api/v1/admin/statistics/dashboard
GET    /api/v1/admin/statistics/orders
GET    /api/v1/admin/statistics/products
GET    /api/v1/admin/statistics/customers
GET    /api/v1/admin/statistics/revenue
POST   /api/v1/admin/statistics/export

# Налаштування
GET    /api/v1/admin/settings
PUT    /api/v1/admin/settings

# Audit Log
GET    /api/v1/admin/audit-logs
GET    /api/v1/admin/audit-logs/export
```

---

## 3. ТЕХНІЧНІ ВИМОГИ

### 3.1. Backend (FastAPI)

#### 3.1.1. Структура проекту (розширена)
```
backend/
├── app/
│   ├── __init__.py
│   ├── main.py                    # ✅ Існує
│   ├── database.py                # ✅ Існує
│   ├── core/
│   │   ├── __init__.py
│   │   ├── config.py              # ✅ Існує
│   │   ├── security.py            # ⚠️ Потрібно доповнити (JWT, 2FA, hashing)
│   │   ├── exceptions.py          # ❌ Створити (власні винятки)
│   │   ├── dependencies.py        # ❌ Створити (dependency injection)
│   │   └── logging.py             # ❌ Створити (налаштування логування)
│   ├── models/
│   │   ├── __init__.py
│   │   ├── category.py            # ✅ Існує
│   │   ├── product.py





